{
	"apiVersion": "v1",
	"kind": "Template",
	"labels": {
		
	},
	"metadata": {
		"annotations": {
			"description": "mqtt-load-generator",
			"iconClass": "jboss"
		},
		"labels": {
			
		},
		"name": "gio-preproc"
	},
	"parameters": [
		{
			"name": "APP_NAME",
			"value": "gio-preproc",
			"description": "Application Name"
		},
		{
			"name": "GIT_REPO",
			"value": "http://tfs.ups.com:8080/tfs/UpsProd/P08SGit_ICC/_git/OPENSHIFT_GIO_DEV",
			"required": true,
			"description": "Git repository, required"
		},
		{
			"name": "GIT_REF",
			"value": "master",
			"description": "Git ref to build"
		},
		{
			"name": "GIO_PROP_ENV",
			"value": "local"
		},
		{
			"name": "SERVICE_NAME",
			"value": "gio-preproc",
			"description": "Exposed Service name"
		},
		{
			"name": "BUILDER_VERSION",
			"value": "1.0.0",
			"description": "Builder version"
		},
		{
			"name": "APP_VERSION",
			"value": "1.0.0",
			"description": "Application version"
		},
		{
			"name": "MAVEN_ARGS",
			"value": "install -DskipTests -e -f GioParent/pom.xml -s GioParent/settings.xml -P Preproc",
			"description": "Arguments passed to mvn in the build"
		},
		{
			"description": "Namespace in which the Fuse ImageStreams are installed. These ImageStreams are normally installed in the openshift namespace. You should only need to modify this if you've installed the ImageStreams in a different namespace/project.",
			"name": "IMAGE_STREAM_NAMESPACE",
			"value": "fuse",
			"required": true
		},
		{
			"generate": "expression",
			"name": "BUILD_SECRET",
			"description": "The secret needed to trigger a build",
			"from": "[a-zA-Z0-9]{8}"
		}
	],
	"objects": [
		{
			"kind": "ImageStream",
			"apiVersion": "v1",
			"metadata": {
				"name": "fuse-builder",
				"labels": {
					"project": "gio-preproc",
					"version": "1.0.0"
				}
			},
			"spec": {
				"dockerImageRepository": "njrarltcda00369.linux.us.ams1907.com/fuse/fuse-builder"
			}
		},
		{
			"kind": "ImageStream",
			"apiVersion": "v1",
			"metadata": {
				"name": "${APP_NAME}",
				"labels": {
					"component": "${APP_NAME}",
					"container": "fuse",
					"group": "quickstarts",
					"project": "${APP_NAME}",
					"provider": "s2i",
					"version": "${APP_VERSION}"
				}
			}
		},
		{
			"kind": "BuildConfig",
			"apiVersion": "v1",
			"metadata": {
				"name": "${APP_NAME}",
				"labels": {
					"component": "${APP_NAME}",
					"container": "fuse",
					"group": "quickstarts",
					"project": "${APP_NAME}",
					"provider": "s2i",
					"version": "${APP_VERSION}"
				}
			},
			"spec": {
				"triggers": [
					{
						"type": "GitHub",
						"github": {
							"secret": "${BUILD_SECRET}"
						}
					},
					{
						"type": "Generic",
						"generic": {
							"secret": "${BUILD_SECRET}"
						}
					},
					{
						"type": "ConfigChange"
					},
					{
						"type": "ImageChange",
						"imageChange": {
							
						}
					}
				],
				"source": {
					"type": "Git",
					"git": {
						"uri": "${GIT_REPO}",
						"ref": "${GIT_REF}"
					},
					"sourceSecret": {
						"name": "gio-preproc-git-secret"
					}
				},
				"strategy": {
					"type": "Source",
					"sourceStrategy": {
						"from": {
							"kind": "ImageStreamTag",
							"namespace": "fuse",
							"name": "fuse-builder:latest"
						},
						"forcePull": true,
						"env": [
							{
								"name": "BUILD_LOGLEVEL",
								"value": "5"
							},
							{
								"name": "MAVEN_ARGS",
								"value": "${MAVEN_ARGS}"
							}
						]
					}
				},
				"output": {
					"to": {
						"kind": "ImageStreamTag",
						"name": "${APP_NAME}:latest"
					}
				},
				"resources": {
					
				}
			}
		},
		{
			"kind": "DeploymentConfig",
			"apiVersion": "v1",
			"metadata": {
				"name": "${APP_NAME}",
				"labels": {
					"component": "${APP_NAME}",
					"container": "fuse",
					"group": "quickstarts",
					"project": "${APP_NAME}",
					"provider": "s2i",
					"version": "${APP_VERSION}"
				}
			},
			"spec": {
				"strategy": {
					"resources": {
						
					}
				},
				"triggers": [
					{
						"type": "ConfigChange"
					},
					{
						"type": "ImageChange",
						"imageChangeParams": {
							"automatic": true,
							"containerNames": [
								"${APP_NAME}"
							],
							"from": {
								"kind": "ImageStreamTag",
								"name": "${APP_NAME}:latest"
							}
						}
					}
				],
				"replicas": 1,
				"selector": {
					"component": "${APP_NAME}",
					"container": "fuse",
					"deploymentconfig": "${APP_NAME}",
					"group": "quickstarts",
					"project": "${APP_NAME}",
					"provider": "s2i",
					"version": "${APP_VERSION}"
				},
				"template": {
					"metadata": {
						"labels": {
							"component": "${APP_NAME}",
							"container": "fuse",
							"deploymentconfig": "${APP_NAME}",
							"group": "quickstarts",
							"project": "${APP_NAME}",
							"provider": "s2i",
							"version": "${APP_VERSION}"
						}
					},
					"spec": {
						"containers": [
							{
								"name": "${APP_NAME}",
								"image": "${APP_NAME}:latest",
								"volumeMounts": [
									{
										"name": "gio-preproc-config-volume",
										"mountPath": "/home/jboss/config"
									},
									{
										"name": "rkm-config-volume",
										"mountPath": "/home/jboss/rkm"
									},
									{
										"name": "secret-volume",
										"mountPath": "/home/jboss/secret",
										"readOnly": true
									}
								],
								"readinessProbe": {
									"exec": {
										"command": [
											"/bin/bash",
											"-c",
											"(curl -f 127.0.0.1:8778) >/dev/null 2>&1; test $? != 7"
										]
									},
									"initialDelaySeconds": 30,
									"timeoutSeconds": 5
								},
								"ports": [
									{
										"containerPort": 8181,
										"name": "hawtio"
									},
									{
										"containerPort": 8778,
										"name": "jolokia"
									}
								],
								"resources": {
									
								}
							}
						],
						"volumes": [
							{
								"name": "gio-preproc-config-volume",
								"configMap": {
									"name": "gio-preproc-config",
									"items": [
										{
											"key": "gio-common-${GIO_PROP_ENV}.properties",
											"path": "gio-common.properties"
										},
										{
											"key": "gio-util-${GIO_PROP_ENV}.properties",
											"path": "gio-util.properties"
										},
										{
											"key": "gio-preproc-${GIO_PROP_ENV}.properties",
											"path": "gio-preproc.properties"
										}
									]
								}
							},
							{
								"name": "rkm-config-volume",
								"configMap": {
									"name": "rkm-config",
									"items": [
										{
											"key": "rkm-config-base.properties",
											"path": "rkm-config-base.properties"
										},
										{
											"key": "rkm-client.reg",
											"path": "rkm-client.reg"
										}
									]
								}
							},
							{
								"name": "secret-volume",
								"secret": {
									"secretName": "rkm-secret"
								}
							}
						]
					}
				}
			}
		},
		{
			"apiVersion": "v1",
			"kind": "Service",
			"metadata": {
				"name": "hawtio",
				"namespace": "fuse"
			},
			"spec": {
				"ports": [
					{
						"protocol": "TCP",
						"port": 8181,
						"targetPort": 8181
					}
				],
				"selector": {
					"container": "fuse"
				},
				"type": "ClusterIP",
				"sessionAffinity": "ClientIP"
			}
		},
		{
			"apiVersion": "v1",
			"kind": "Route",
			"metadata": {
				"name": "hawtio",
				"namespace": "fuse"
			},
			"spec": {
				"host": "hawtio-fuse.paasdev.ams1907.com",
				"to": {
					"kind": "Service",
					"name": "hawtio"
				}
			}
		}
	]
}